<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Editor Pro HTML + CSS + JS</title>
<style>
  body {
    margin:0;
    font-family:'Segoe UI',sans-serif;
    background:linear-gradient(120deg,#00ffcc,#0066ff,#ff00ff);
    background-size:400% 400%;
    animation:gradient 10s ease infinite;
    color:#fff;
    display:flex;
    flex-direction:column;
    height:100vh;
  }
  @keyframes gradient {
    0%{background-position:0% 50%;}
    50%{background-position:100% 50%;}
    100%{background-position:0% 50%;}
  }
  header {
    background:rgba(0,0,0,0.5);
    padding:10px 20px;
    display:flex;
    justify-content:space-between;
    align-items:center;
  }
  header h1{font-size:1rem;margin:0;}
  .controls{display:flex;gap:8px;}
  button{
    background:linear-gradient(90deg,#00ffcc,#0066ff);
    border:none;
    padding:8px 12px;
    border-radius:5px;
    cursor:pointer;
    font-weight:600;
    color:#000;
    transition:0.2s;
  }
  button:hover{transform:scale(1.05);opacity:0.9;}
  .container{display:grid;grid-template-columns:1fr 1fr;flex:1;overflow:hidden;}
  .editors{display:flex;flex-direction:column;background:rgba(0,0,0,0.4);padding:10px;}
  .editors label{font-weight:bold;margin-top:8px;}
  textarea{
    width:100%;
    height:33%;
    resize:none;
    background:rgba(255,255,255,0.1);
    color:#fff;
    border:1px solid rgba(255,255,255,0.2);
    border-radius:6px;
    padding:8px;
    font-family:monospace;
    font-size:0.9rem;
  }
  iframe{width:100%;height:100%;border:none;background:#fff;}
  footer{background:rgba(0,0,0,0.5);text-align:center;padding:5px;font-size:0.8rem;}
</style>
</head>
<body>
  <header>
    <h1>üí° Editor Pro HTML + CSS + JS</h1>
    <div class="controls">
      <button id="previewBtn">Vista Previa</button>
      <button id="clearBtn">Borrar</button>
      <button id="downloadBtn">Descargar</button>
    </div>
  </header>

  <div class="container">
    <div class="editors">
      <label>HTML:</label>
      <textarea id="htmlCode" placeholder="Escribe tu HTML aqu√≠..."></textarea>
      <label>CSS:</label>
      <textarea id="cssCode" placeholder="Escribe tu CSS aqu√≠..."></textarea>
      <label>JavaScript:</label>
      <textarea id="jsCode" placeholder="Escribe tu JavaScript aqu√≠..."></textarea>
    </div>
    <iframe id="preview"></iframe>
  </div>

  <footer>Creado con ‚ù§Ô∏è | Compatible con WebIntoApp | GPT-5</footer>

  <script>
    const htmlCode = document.getElementById('htmlCode');
    const cssCode = document.getElementById('cssCode');
    const jsCode = document.getElementById('jsCode');
    const previewFrame = document.getElementById('preview');

    document.getElementById('previewBtn').addEventListener('click',()=>{
      const html=htmlCode.value;
      const css="<style>"+cssCode.value+"</style>";
      const js="<script>"+jsCode.value+"<\/script>";
      const final=html+css+js;
      const doc=previewFrame.contentDocument||previewFrame.contentWindow.document;
      doc.open();doc.write(final);doc.close();
    });

    document.getElementById('clearBtn').addEventListener('click',()=>{
      if(confirm("¬øBorrar todo el c√≥digo?")){
        htmlCode.value="";
        cssCode.value="";
        jsCode.value="";
        const doc=previewFrame.contentDocument||previewFrame.contentWindow.document;
        doc.open();doc.write("");doc.close();
      }
    });

    document.getElementById('downloadBtn').addEventListener('click',()=>{
      const html=htmlCode.value;
      const css="<style>"+cssCode.value+"</style>";
      const js="<script>"+jsCode.value+"<\/script>";
      const finalHTML=`<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Proyecto Exportado</title>
${css}
</head>
<body>
${html}
${js}
</body>
</html>`;

      try {
        // Detectar si estamos en WebIntoApp o en navegador normal
        const isWebView = navigator.userAgent.includes("wv") || /WebView|WebIntoApp/i.test(navigator.userAgent);

        if(!isWebView && 'showSaveFilePicker' in window){
          // navegador moderno
          saveFileDirect(finalHTML);
        } else {
          // fallback para WebIntoApp
          downloadAsFile(finalHTML);
        }
      } catch(e){
        console.error(e);
        alert("‚ö†Ô∏è No se pudo guardar el archivo correctamente.");
      }
    });

    async function saveFileDirect(content){
      const handle = await window.showSaveFilePicker({
        suggestedName:"proyecto.html",
        types:[{description:"HTML",accept:{"text/html":[".html"]}}]
      });
      const writable = await handle.createWritable();
      await writable.write(content);
      await writable.close();
      alert("‚úÖ Archivo guardado correctamente.");
    }

    function downloadAsFile(content){
      const blob = new Blob([content],{type:"text/html"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "proyecto.html";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      alert("‚úÖ Archivo exportado (ver carpeta Descargas).");
    }
  </script>
</body>
</html>
